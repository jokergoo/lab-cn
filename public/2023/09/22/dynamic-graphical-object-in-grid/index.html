<!DOCTYPE html>
<html lang="en-US">
  <head><script src="/lab-cn/livereload.js?mindelay=10&amp;v=2&amp;port=4321&amp;path=lab-cn/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="A website built through Hugo and blogdown.">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


    
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400&display=swap" rel="stylesheet" media="print" type="text/css" onload="this.media='all'">
    

    


<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />




    <title>
      
      
         Dynamic graphical object in grid 
      
    </title>
    <link rel="canonical" href="http://localhost:4321/lab-cn/2023/09/22/dynamic-graphical-object-in-grid/">

    <style>
  * {
    border:0;
    font:inherit;
    vertical-align:baseline;
    margin:0;
    padding:0;
    color: black;
    text-decoration-skip: ink;
    overflow-wrap: break-word;
  }

  body {
    font-family: Georgia,serif;
    line-height:160%;
    color:#1d1313;
    max-width:1000px;
    margin:auto;
    min-height: 600px;
    font-size: 17px;
  }

  p {
    margin: 20px 0;
  }

  a img {
    border:none;
  }

  img {
    margin: 10px auto 10px auto;
    max-width: 100%;
    display: block;
  }

  .left-justify { float: left; }
  .right-justify { float:right; }

  pre, code {
    font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
    background-color: #f7f7f7;
  }

  code {
    padding: 4px;
  }

  pre {
    margin-top: 0;
    margin-bottom: 16px;
    word-wrap: normal;
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
  }

  pre>code {
    padding: 0;
    margin: 0;
    font-size: 100%;
    word-break: normal;
    white-space: pre;
    background: transparent;
    border: 0;
  }

  pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: transparent;
    border: 0;
  }

  pre code::before,
  pre code::after {
    content: normal;
  }

  em,q,em,dfn {
    font-style:italic;
  }

  .sans,html .gist .gist-file .gist-meta {
    font-family:"Open Sans","Myriad Pro",Myriad,sans-serif;
  }

  .mono,pre,code,tt,p code,li code {
    font-family:Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;
  }

  strong {
    font-weight:600;
  }

  q:before {
    content:"\201C";
  }

  q:after {
    content:"\201D";
  }

  del,s {
    text-decoration:line-through;
  }

  blockquote {
    font-family:"Old Standard TT",serif;
    text-align:center;
    padding:50px;
  }

  blockquote p {
    display:inline-block;
    font-style:italic;
  }

  blockquote:before,blockquote:after {
    font-family:"Old Standard TT",serif;
    content:'\201C';
    color:#403c3b;
  }

  blockquote:after {
    content:'\201D';
  }

  hr {
    width:40%;
    height: 1px;
    background:#403c3b;
    margin: 25px auto;
  }


  h2, h3 {
    margin-top: 40px;
    margin-bottom: 20px;
  }

  h1 a,h2 a,h3 a {
    text-decoration:none;
  }

  h1,h2 {
    margin-top:28px;
  }

  h1 {
    font-size: 2em;
  }

  h2, h3 {
    font-size: 1.5em;
  }

  #sub-header, .date {
    color:#403c3b;
  }

  #sub-header {
    margin: 0 4px;
    font-style: italic;
  }

  #nav h1 a {
    color:#1d1313;
    line-height:120%;
  }

  .posts_listing a,#nav a {
    text-decoration: none;
  }

  li {
    margin-left: 20px;
  }

  ul li {
    margin-left: 20px;
    padding-top: 2px;
    padding-bottom: 2px;
  }


  #nav ul li:before, .posts_listing li:before {
    content:'';
    margin-right:0;
  }

  #content {
    text-align:left;
    width:100%;
    padding:30px 0 80px;
  }

  #content h1,#content h2 {
    margin-bottom:5px;
  }

  #content .entry-content {
    margin-top:15px;
  }

  #content .date {
    margin-left:3px;
  }


  .highlight {
    margin: 10px 0;
  }

  .posts_listing {
    margin:0 0 50px;
  }

  .posts_listing li {
    margin:0 0 25px 15px;
  }

 
  #nav {
    text-align:center;
    position:static;
    margin-top:60px;
  }

  a {
    text-decoration: underline;
    text-decoration-color: #CCC;
    text-underline-offset: 5px;
  }

  a:hover {
    text-decoration-color: black;
  }

  
  #nav li {
    list-style-type:none;
    display:table-cell;
    padding: 0 20px;
  }

  #links {
    display: flex;
    justify-content: space-between;
    margin: 50px 0 0 0;
  }

  #links :nth-child(1) {
    margin-right:0.5em;;
  }

  #links :nth-child(2) {
    margin-left:0.5em;;
  }

  #not-found {
    text-align: center;
  }

  #not-found a {
    font-size: 3em;
    text-decoration: none;
    display: inline-block;
    padding-top: 225px;
    padding-bottom: 225px;
  }


#soft-info table td {
  padding: 2px 10px 2px 0px;
}


  @media (max-width: 750px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    #nav h1 a {
      font-size:28px;
    }

    #nav li {
      font-size:13px;
      padding: 0 5px;
    }

    #content {
      margin-top:0;
      padding-top:50px;
      font-size:14px;
    }

    #content h1 {
      font-size:25px;
    }

    #content h2 {
      font-size:22px;
    }

    .posts_listing li div {
      font-size:12px;
    }
  }

  @media (max-width: 400px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    #nav h1 a {
      font-size:22px;
    }

    #nav li {
      font-size:12px;
      padding: 0 5px;
    }

    #content {
      margin-top:0;
      padding-top:20px;
      font-size:12px;
    }

    #content h1 {
      font-size:20px;
    }

    #content h2 {
      font-size:18px;
    }

    .posts_listing li div{
      font-size:12px;
    }
  }

  @media (prefers-color-scheme: dark) {
    *, #nav h1 a {
      color: #FDFDFD;
    }

    body {
      background: #121212;
    }

    pre, code {
      background-color: #262626;
    }

    #sub-header, .date {
      color: #BABABA;
    }

    hr {
      background: #EBEBEB;
    }
  }
</style>


    </head>
<style>
#nav-logo-text {
    float: left;
    margin-top: 0px;
    margin-left: 0px;
    font-size: 2em;
    font-weight: 100;
}
#at {
  font-size:24px;
  padding:0px 2px;
}
</style>
<script>
window.root_dir = "http:\/\/localhost:4321\/lab-cn\/";
const regex = /^https?:\/\/[^/]+?\//;
root_dir = root_dir.replace(regex, "/");
$( function() {
  $("#content img").each(function(i) {
        var old_src = $(this).attr("src");
        var pattern = new RegExp("^" + root_dir);
        if(!pattern.test(old_src)) {
            pattern = /^http(s):\/\//;
            if(!pattern.test(old_src)) {
                $(this).attr("src", root_dir + "/" + old_src);
            }
        }
    });
  $("#nav-logo-text").attr("href", root_dir);
  $("#no-found-a").attr("href", root_dir);

  var url = window.location.href;
  var pattern = /lab-cn/;
  var url2 = url.replace(pattern, "lab-en");
  $("#nav ul li:last-child a").attr("href", url2);
})
</script>
  <body>
    <section id=nav>
      <h1><a class="h-card" href="/"></a></h1>
      <a href="#" id="nav-logo-text">Gu<span style="padding:0px 2px">.</span>Z<span id="at">@</span>SUAT-SZ</a>
      <ul style="float:right">
        
          <li><a href="/lab-cn/research/">研究</a></li>
        
          <li><a href="/lab-cn/publication/">论文</a></li>
        
          <li><a href="/lab-cn/software/">软件</a></li>
        
          <li><a href="/lab-cn/post">文章</a></li>
        
          <li><a href="/lab-cn/members/">成员</a></li>
        
          <li><a href="/lab-cn/opening/">职位</a></li>
        
          <li><a href="/lab-en/">EN</a></li>
        
      </ul>
      <div style="clear:both"></div>
    </section>


<section id=content>
  <h1 style="margin-bottom: 40px"> Dynamic graphical object in grid </h1>

  
    <div id=sub-header>
      Zuguang Gu · September 2023
    </div>
  

  <div class="entry-content">
    <p>Consider the following task: drawing two circles at <code>(1, 0)</code> and <code>(-1, 0)</code> with both radius of 1.</p>
<pre><code class="language-r">theta = seq(0, 2*pi, length = 50)

x1 = cos(theta) + 1
y1 = sin(theta)

x2 = cos(theta) - 1
y2 = sin(theta)
</code></pre>
<p>We might think of the following way:</p>
<pre><code class="language-r">library(grid)
grid.newpage()
pushViewport(viewport(xscale = c(-2, 2), yscale = c(-1, 1)))
grid.lines(x1, y1, default.units = &quot;native&quot;)
grid.lines(x2, y2, default.units = &quot;native&quot;)
</code></pre>
<img src="/lab-cn/post/2023-09-22-dynamic-graphical-object-in-grid_files/figure-html/unnamed-chunk-3-1.png" width="768" style="display: block; margin: auto;" />
<p>Unfortunately it only works when the width of the image is twice of the height.</p>
<p>To enforce the aspect ratio to 2:1, we may think of using the <code>snpc</code> unit. Taking
the height of the viewport to <code>1snpc</code> and the width of the viewport to <code>2snpc</code>.</p>
<p>It works when the height of the image is less than width/2 of the image (in this case, <code>1snpc</code> is the height of the image).</p>
<pre><code class="language-r">grid.newpage()
pushViewport(viewport(xscale = c(-2, 2), yscale = c(-1, 1), 
    width = unit(2, &quot;snpc&quot;), height = unit(1, &quot;snpc&quot;)))
grid.lines(x1, y1, default.units = &quot;native&quot;)
grid.lines(x2, y2, default.units = &quot;native&quot;)
</code></pre>
<img src="/lab-cn/post/2023-09-22-dynamic-graphical-object-in-grid_files/figure-html/unnamed-chunk-4-1.png" width="768" style="display: block; margin: auto;" />
<p>But when the height of the image is larger than width/2 but smaller than
1width, circles will exceed the image area.</p>
<img src="/lab-cn/post/2023-09-22-dynamic-graphical-object-in-grid_files/figure-html/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;" />
<p>You may set <code>width = unit(1, &quot;snpc&quot;), height = unit(0.5, &quot;snpc&quot;)</code>, but it has the same problem.</p>
<p>Here the core problem is the viewport is dynamically changed. We want the size
of the two circles to be automatically adjusted to maximally fill the image.
In this post, I will introduce how to construct a dynamic graphical object.</p>
<p>First I create a new grob object in the class <code>double_circle</code> which contains two circles
(in form of two <code>linesGrob()</code> calls). I also create a viewport to include the two
line grobs.</p>
<pre><code class="language-r">vp = viewport(xscale = c(-2, 2), yscale = c(-1, 1))
grob = grobTree(linesGrob(x1, y1, default.units = &quot;native&quot;), 
                linesGrob(x2, y2, default.units = &quot;native&quot;),
                vp = vp, cl = &quot;double_circle&quot;)
</code></pre>
<p>As you may see, creating a new grob is quite simple. You just integrate a list
of simple grobs (e.g. points, lines) in the <code>grobTree()</code> function. The class
is defined by a character string assigned to the <code>cl</code> argument.</p>
<p>In <code>grob</code>, the viewport is in the <code>vp</code> slot which we will dynamically update later.</p>
<pre><code class="language-r">str(grob$vp)
</code></pre>
<pre><code>## List of 33
##  $ x             : 'simpleUnit' num 0.5npc
##   ..- attr(*, &quot;unit&quot;)= int 0
##  $ y             : 'simpleUnit' num 0.5npc
##   ..- attr(*, &quot;unit&quot;)= int 0
##  $ width         : 'simpleUnit' num 1npc
##   ..- attr(*, &quot;unit&quot;)= int 0
##  $ height        : 'simpleUnit' num 1npc
##   ..- attr(*, &quot;unit&quot;)= int 0
##  $ justification : num [1:2] 0.5 0.5
##  $ gp            : list()
##   ..- attr(*, &quot;class&quot;)= chr &quot;gpar&quot;
##  $ clip          : logi FALSE
##  $ xscale        : num [1:2] -2 2
##  $ yscale        : num [1:2] -1 1
##  $ angle         : num 0
##  $ layout        : NULL
##  $ layout.pos.row: NULL
##  $ layout.pos.col: NULL
##  $ valid.just    : num [1:2] 0.5 0.5
##  $ valid.pos.row : NULL
##  $ valid.pos.col : NULL
##  $ name          : chr &quot;GRID.VP.4&quot;
##  $ parentgpar    : NULL
##  $ gpar          : NULL
##  $ trans         : NULL
##  $ widths        : NULL
##  $ heights       : NULL
##  $ width.cm      : NULL
##  $ height.cm     : NULL
##  $ rotation      : NULL
##  $ cliprect      : NULL
##  $ parent        : NULL
##  $ children      : NULL
##  $ devwidth      : NULL
##  $ devheight     : NULL
##  $ clippath      : NULL
##  $ mask          : logi TRUE
##  $ resolvedmask  : NULL
##  - attr(*, &quot;class&quot;)= chr &quot;viewport&quot;
</code></pre>
<p>In <strong>grid</strong>, when a grob is drawn, a list of functions will be executed in
serial. Here I introduce the generic function <code>makeContext()</code> which will be
executed before drawing the graphics. To use <code>makeContext()</code>, you need to
define a S3 method for the grob class. The input is the grob and the output is
an edited grob. <code>makeContext()</code> is mainly for adjusting the viewport of the graphics in the grob.</p>
<p>In the following example, for the <code>double_circle</code> grob, the width and the
height of the current viewport are checked. If the width is larger than two
times of the height, the width is adjusted to two times of the height, or else
the height is adjusted to half of the width of the viewport.</p>
<pre><code class="language-r">makeContext.double_circle = function(x) {
    vp_width = convertWidth(x$vp$width, &quot;in&quot;, valueOnly = TRUE)
    vp_height = convertHeight(x$vp$height, &quot;in&quot;, valueOnly = TRUE)

    if(vp_width &gt; 2*vp_height) {
        x$vp$width = unit(2*vp_height, &quot;in&quot;)
        x$vp$height = unit(vp_height, &quot;in&quot;)
    } else {
        x$vp$width = unit(vp_width, &quot;in&quot;)
        x$vp$height = unit(vp_width/2, &quot;in&quot;)
    }
    x
}
</code></pre>
<p>Now we can use <code>grid.draw()</code> to draw the grob without worring the size of the image device.</p>
<pre><code class="language-r">grid.newpage()
grid.draw(grob)
</code></pre>
<p><img src="https://github.com/jokergoo/BioCartaImage/assets/449218/348453bb-f09b-443d-a8bb-dfb34b088679" alt=""></p>
<pre><code class="language-r">sessionInfo()
</code></pre>
<pre><code>## R version 4.4.2 (2024-10-31)
## Platform: aarch64-apple-darwin20
## Running under: macOS 26.0.1
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib 
## LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0
## 
## locale:
## [1] C.UTF-8/UTF-8/C.UTF-8/C/C.UTF-8/C.UTF-8
## 
## time zone: Europe/Berlin
## tzcode source: internal
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] knitr_1.50     colorout_1.3-2
## 
## loaded via a namespace (and not attached):
##  [1] digest_0.6.37     R6_2.6.1          bookdown_0.44     fastmap_1.2.0     xfun_0.51        
##  [6] blogdown_1.19     cachem_1.1.0      htmltools_0.5.8.1 rmarkdown_2.29    lifecycle_1.0.4  
## [11] cli_3.6.4         sass_0.4.9        jquerylib_0.1.4   compiler_4.4.2    tools_4.4.2      
## [16] evaluate_1.0.3    bslib_0.9.0       yaml_2.3.10       jsonlite_1.9.0    rlang_1.1.5
</code></pre>

  </div>

</section>


<style>
.footer p{
	color: #AAA;
	text-align: left;
	text-decoration: none;
	max-width:400px;
	border-top: 1px solid #AAA;
	padding-top:10px;
	font-size: 0.8em;
}
.footer p a {
	color: #AAA;
	text-align: left;
	text-decoration: none;
}
</style>

<footer class="footer">
<p>网站使用 <a href="https://gohugo.io/">Hugo</a>，<a href="https://bookdown.org/yihui/blogdown/">blogdown</a>，<a href="https://github.com/davidhampgonsalves/hugo-black-and-light-theme">Black & Light 主题</a>创建</p>
</footer>





<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>




<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


</body>
</html>



