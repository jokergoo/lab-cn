<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="A website built through Hugo and blogdown.">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


    
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400&display=swap" rel="stylesheet" media="print" type="text/css" onload="this.media='all'">
    

    


<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />




    <title>
      
      
         Simplified simplifyEnrichment plot 
      
    </title>
    <link rel="canonical" href="/lab-cn/2023/10/02/simplified-simplifyenrichment-plot/">

    <style>
  * {
    border:0;
    font:inherit;
    vertical-align:baseline;
    margin:0;
    padding:0;
    color: black;
    text-decoration-skip: ink;
    overflow-wrap: break-word;
  }

  body {
    font-family: Georgia,serif;
    line-height:160%;
    color:#1d1313;
    max-width:1000px;
    margin:auto;
    min-height: 600px;
    font-size: 17px;
  }

  p {
    margin: 20px 0;
  }

  a img {
    border:none;
  }

  img {
    margin: 10px auto 10px auto;
    max-width: 100%;
    display: block;
  }

  .left-justify { float: left; }
  .right-justify { float:right; }

  pre, code {
    font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
    background-color: #f7f7f7;
  }

  code {
    padding: 4px;
  }

  pre {
    margin-top: 0;
    margin-bottom: 16px;
    word-wrap: normal;
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
  }

  pre>code {
    padding: 0;
    margin: 0;
    font-size: 100%;
    word-break: normal;
    white-space: pre;
    background: transparent;
    border: 0;
  }

  pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: transparent;
    border: 0;
  }

  pre code::before,
  pre code::after {
    content: normal;
  }

  em,q,em,dfn {
    font-style:italic;
  }

  .sans,html .gist .gist-file .gist-meta {
    font-family:"Open Sans","Myriad Pro",Myriad,sans-serif;
  }

  .mono,pre,code,tt,p code,li code {
    font-family:Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;
  }

  strong {
    font-weight:600;
  }

  q:before {
    content:"\201C";
  }

  q:after {
    content:"\201D";
  }

  del,s {
    text-decoration:line-through;
  }

  blockquote {
    font-family:"Old Standard TT",serif;
    text-align:center;
    padding:50px;
  }

  blockquote p {
    display:inline-block;
    font-style:italic;
  }

  blockquote:before,blockquote:after {
    font-family:"Old Standard TT",serif;
    content:'\201C';
    color:#403c3b;
  }

  blockquote:after {
    content:'\201D';
  }

  hr {
    width:40%;
    height: 1px;
    background:#403c3b;
    margin: 25px auto;
  }


  h2, h3 {
    margin-top: 40px;
    margin-bottom: 20px;
  }

  h1 a,h2 a,h3 a {
    text-decoration:none;
  }

  h1,h2 {
    margin-top:28px;
  }

  h1 {
    font-size: 2em;
  }

  h2, h3 {
    font-size: 1.5em;
  }

  #sub-header, .date {
    color:#403c3b;
  }

  #sub-header {
    margin: 0 4px;
    font-style: italic;
  }

  #nav h1 a {
    color:#1d1313;
    line-height:120%;
  }

  .posts_listing a,#nav a {
    text-decoration: none;
  }

  li {
    margin-left: 20px;
  }

  ul li {
    margin-left: 20px;
    padding-top: 2px;
    padding-bottom: 2px;
  }


  #nav ul li:before, .posts_listing li:before {
    content:'';
    margin-right:0;
  }

  #content {
    text-align:left;
    width:100%;
    padding:30px 0 80px;
  }

  #content h1,#content h2 {
    margin-bottom:5px;
  }

  #content .entry-content {
    margin-top:15px;
  }

  #content .date {
    margin-left:3px;
  }


  .highlight {
    margin: 10px 0;
  }

  .posts_listing {
    margin:0 0 50px;
  }

  .posts_listing li {
    margin:0 0 25px 15px;
  }

 
  #nav {
    text-align:center;
    position:static;
    margin-top:60px;
  }

  a {
    text-decoration: underline;
    text-decoration-color: #CCC;
    text-underline-offset: 5px;
  }

  a:hover {
    text-decoration-color: black;
  }

  
  #nav li {
    list-style-type:none;
    display:table-cell;
    padding: 0 20px;
  }

  #links {
    display: flex;
    justify-content: space-between;
    margin: 50px 0 0 0;
  }

  #links :nth-child(1) {
    margin-right:0.5em;;
  }

  #links :nth-child(2) {
    margin-left:0.5em;;
  }

  #not-found {
    text-align: center;
  }

  #not-found a {
    font-size: 3em;
    text-decoration: none;
    display: inline-block;
    padding-top: 225px;
    padding-bottom: 225px;
  }


#soft-info table td {
  padding: 2px 10px 2px 0px;
}


  @media (max-width: 750px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    #nav h1 a {
      font-size:28px;
    }

    #nav li {
      font-size:13px;
      padding: 0 5px;
    }

    #content {
      margin-top:0;
      padding-top:50px;
      font-size:14px;
    }

    #content h1 {
      font-size:25px;
    }

    #content h2 {
      font-size:22px;
    }

    .posts_listing li div {
      font-size:12px;
    }
  }

  @media (max-width: 400px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    #nav h1 a {
      font-size:22px;
    }

    #nav li {
      font-size:12px;
      padding: 0 5px;
    }

    #content {
      margin-top:0;
      padding-top:20px;
      font-size:12px;
    }

    #content h1 {
      font-size:20px;
    }

    #content h2 {
      font-size:18px;
    }

    .posts_listing li div{
      font-size:12px;
    }
  }

  @media (prefers-color-scheme: dark) {
    *, #nav h1 a {
      color: #FDFDFD;
    }

    body {
      background: #121212;
    }

    pre, code {
      background-color: #262626;
    }

    #sub-header, .date {
      color: #BABABA;
    }

    hr {
      background: #EBEBEB;
    }
  }
</style>


    </head>
<style>
#nav-logo-text {
    float: left;
    margin-top: 0px;
    margin-left: 0px;
    font-size: 2em;
    font-weight: 100;
}
#at {
  font-size:24px;
  padding:0px 2px;
}
</style>
<script>
window.root_dir = "\/lab-cn\/";
const regex = /^https?:\/\/[^/]+?\//;
root_dir = root_dir.replace(regex, "/");
$( function() {
  $("#content img").each(function(i) {
        var old_src = $(this).attr("src");
        var pattern = new RegExp("^" + root_dir);
        if(!pattern.test(old_src)) {
            pattern = /^http(s):\/\//;
            if(!pattern.test(old_src)) {
                $(this).attr("src", root_dir + "/" + old_src);
            }
        }
    });
  $("#nav-logo-text").attr("href", root_dir);
  $("#no-found-a").attr("href", root_dir);

  var url = window.location.href;
  var pattern = /lab-cn/;
  var url2 = url.replace(pattern, "lab-en");
  $("#nav ul li:last-child a").attr("href", url2);
})
</script>
  <body>
    <section id=nav>
      <h1><a class="h-card" href="/"></a></h1>
      <a href="#" id="nav-logo-text">Gu<span style="padding:0px 2px">.</span>Z<span id="at">@</span>SUAT-SZ</a>
      <ul style="float:right">
        
          <li><a href="/lab-cn/research/">研究</a></li>
        
          <li><a href="/lab-cn/publication/">论文</a></li>
        
          <li><a href="/lab-cn/software/">软件</a></li>
        
          <li><a href="/lab-cn/post">博客</a></li>
        
          <li><a href="/lab-cn/members/">成员</a></li>
        
          <li><a href="/lab-cn/opening/">职位</a></li>
        
          <li><a href="/lab-en/">EN</a></li>
        
      </ul>
      <div style="clear:both"></div>
    </section>


<section id=content>
  <h1 style="margin-bottom: 40px"> Simplified simplifyEnrichment plot </h1>

  
    <div id=sub-header>
      Zuguang Gu · October 2023
    </div>
  

  <div class="entry-content">
    <p>The <code>lt</code> object contains a list of GO enrichment tables.</p>
<pre><code class="language-r">names(lt)
</code></pre>
<pre><code>## [1] &quot;BP_km1&quot; &quot;BP_km2&quot; &quot;BP_km3&quot; &quot;BP_km4&quot;
</code></pre>
<pre><code class="language-r">head(lt[[1]][, 1:7])
</code></pre>
<pre><code>##                    ID                         Description GeneRatio   BgRatio RichFactor
## GO:0006974 GO:0006974                 DNA damage response    84/471 924/18986 0.09090909
## GO:0006281 GO:0006281                          DNA repair    65/471 625/18986 0.10400000
## GO:1903047 GO:1903047          mitotic cell cycle process    71/471 784/18986 0.09056122
## GO:0000278 GO:0000278                  mitotic cell cycle    76/471 929/18986 0.08180840
## GO:0051052 GO:0051052 regulation of DNA metabolic process    52/471 505/18986 0.10297030
## GO:0051276 GO:0051276             chromosome organization    58/471 644/18986 0.09006211
##            FoldEnrichment   zScore
## GO:0006974       3.664544 13.24432
## GO:0006281       4.192238 12.94318
## GO:1903047       3.650521 12.08881
## GO:0000278       3.297695 11.45332
## GO:0051052       4.150730 11.44585
## GO:0051276       3.630402 10.83167
</code></pre>
<p>We first demonstrate the new plot on the single enrichment table. To use the <strong>simplifyEnrichment</strong> package,
we extract significant GO terms, and then call <code>simplifyGO()</code>.</p>
<pre><code class="language-r">library(simplifyEnrichment)
df = lt[[1]]
go_id = df$ID[df$p.adjust &lt; 0.01]
simplifyGO(go_id)
</code></pre>
<img src="/lab-cn/post/2023-10-02-simplified-simplify-enrichment-plot_files/figure-html/unnamed-chunk-4-1.png" width="806.4" style="display: block; margin: auto;" />
<p>The plot looks good, but it still contains too many graphic contents. For example, the GO similarity heatmap
is useful, but it takes too much space on the final plot. Here I developed a new function <code>summarizeGO()</code> which
simplifies the enrichment results even more. The idea is that since we already have the GO clusters, with a certain
statistic of enrichment, we can simply use its average for the GO cluster.</p>
<p>In the following example, we use <code>-log10(p.adjust)</code> as an enrichment measure. The heights of bars correspond to
the mean of <code>-log10(p.adjust)</code> of GO terms in different GO clusters. On the left side, we still use the word clouds which
efficiently show the general functions in each GO cluster.</p>
<pre><code class="language-r">l = df$p.adjust &lt; 0.01
summarizeGO(df$ID[l], -log10(df$p.adjust)[l], axis_label = &quot;average -log10(p.adjust)&quot;)
</code></pre>
<img src="/lab-cn/post/2023-10-02-simplified-simplify-enrichment-plot_files/figure-html/unnamed-chunk-5-1.png" width="691.2" style="display: block; margin: auto;" />
<p>GO IDs can be attached to the numeric value vector, but this time, the <code>value</code> argument
should be explicitely specified when calling <code>summarizeGO()</code>.</p>
<pre><code class="language-r">v = -log10(df$p.adjust)
names(v) = df$ID
summarizeGO(value = v[l], axis_label = &quot;average -log10(p.adjust)&quot;)
</code></pre>
<p>Beside <code>-log10(p.adjust)</code>, we also suggest to use log2 fold enrichment as the enrichment measure. It is calculated as</p>
<p>$$ \log_2 \left( \frac{k/m_1}{m_2/n} \right) $$</p>
<p>where <code>\(k\)</code> is the number of DE genes (if the genes of interest are DE genes) in
a gene set, <code>\(m_1\)</code> is the size of DE genes, <code>\(m_2\)</code> is the size of the gene set,
<code>\(n\)</code> is the total number of genes in the universal set. Of course, the definition
of <code>\(m_1\)</code> and <code>\(m_2\)</code> can be switched.</p>
<pre><code class="language-r">k = as.numeric(gsub(&quot;/\\d+$&quot;, &quot;&quot;, df$GeneRatio))
m1 = as.numeric(gsub(&quot;^\\d+/&quot;, &quot;&quot;, df$GeneRatio))
m2 = as.numeric(gsub(&quot;/\\d+$&quot;, &quot;&quot;, df$BgRatio))
n = as.numeric(gsub(&quot;^\\d+/&quot;, &quot;&quot;, df$BgRatio))
log2_fold_enrichment = log2(k*n/m1/m2)

summarizeGO(df$ID[l], log2_fold_enrichment[l], axis_label = &quot;average log2(fold_enrichment)&quot;)
</code></pre>
<img src="/lab-cn/post/2023-10-02-simplified-simplify-enrichment-plot_files/figure-html/unnamed-chunk-7-1.png" width="691.2" style="display: block; margin: auto;" />
<p>Of course, you can construct a named <code>log2_fold_enrichment</code> vector which only contains significant GO terms.</p>
<pre><code class="language-r">names(log2_fold_enrichment) = df$ID
summarizeGO(value = log2_fold_enrichment[l], axis_label = &quot;average log2(fold_enrichment)&quot;)
</code></pre>
<p>For multiple GO enrichment results, <code>simplifyGOFromMultipleLists()</code> can be used to visualize and compare GO clusters.</p>
<pre><code class="language-r">simplifyGOFromMultipleLists(lt, padj_cutoff = 0.001)
</code></pre>
<img src="/lab-cn/post/2023-10-02-simplified-simplify-enrichment-plot_files/figure-html/unnamed-chunk-9-1.png" width="100%" style="display: block; margin: auto;" />
<p><code>summarizeGO()</code> can also be used to simplify such plot. Now the value of <code>value</code> is a list of numeric named vectors which contains
significant GO terms in each enrichment table:</p>
<pre><code class="language-r">value = lapply(lt, function(df) {
    v = -log10(df$p.adjust)
    names(v) = df$ID
    v[df$p.adjust &lt; 0.001]
})
summarizeGO(value = value, axis_label = &quot;average -log10(p.adjust)&quot;, legend_title = &quot;-log10(p.adjust)&quot;)
</code></pre>
<img src="/lab-cn/post/2023-10-02-simplified-simplify-enrichment-plot_files/figure-html/unnamed-chunk-10-1.png" width="691.2" style="display: block; margin: auto;" />
<pre><code class="language-r">sessionInfo()
</code></pre>
<pre><code>## R version 4.4.2 (2024-10-31)
## Platform: aarch64-apple-darwin20
## Running under: macOS 26.0.1
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib 
## LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0
## 
## Random number generation:
##  RNG:     L'Ecuyer-CMRG 
##  Normal:  Inversion 
##  Sample:  Rejection 
##  
## locale:
## [1] C.UTF-8/UTF-8/C.UTF-8/C/C.UTF-8/C.UTF-8
## 
## time zone: Europe/Berlin
## tzcode source: internal
## 
## attached base packages:
## [1] stats4    stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] simplifyEnrichment_2.0.0 hu6800.db_3.13.0         org.Hs.eg.db_3.20.0     
##  [4] AnnotationDbi_1.68.0     IRanges_2.40.1           S4Vectors_0.44.0        
##  [7] Biobase_2.66.0           BiocGenerics_0.52.0      cola_2.12.0             
## [10] knitr_1.50               colorout_1.3-2          
## 
## loaded via a namespace (and not attached):
##   [1] eulerr_7.0.2            RColorBrewer_1.1-3      jsonlite_1.9.0         
##   [4] shape_1.4.6.1           magrittr_2.0.3          magick_2.8.5           
##   [7] modeltools_0.2-24       ggtangle_0.0.6          farver_2.1.2           
##  [10] rmarkdown_2.29          GlobalOptions_0.1.2     fs_1.6.5               
##  [13] zlibbioc_1.52.0         vctrs_0.6.5             Cairo_1.6-2            
##  [16] memoise_2.0.1           ggtree_3.14.0           blogdown_1.19          
##  [19] htmltools_0.5.8.1       gridGraphics_0.5-1      sass_0.4.9             
##  [22] bslib_0.9.0             plyr_1.8.9              impute_1.80.0          
##  [25] cachem_1.1.0            commonmark_1.9.2        igraph_2.1.4           
##  [28] mime_0.12               lifecycle_1.0.4         iterators_1.0.14       
##  [31] pkgconfig_2.0.3         gson_0.1.0              Matrix_1.7-1           
##  [34] R6_2.6.1                fastmap_1.2.0           shiny_1.10.0           
##  [37] GenomeInfoDbData_1.2.13 MatrixGenerics_1.18.1   clue_0.3-66            
##  [40] digest_0.6.37           aplot_0.2.4             enrichplot_1.26.6      
##  [43] colorspace_2.1-1        patchwork_1.3.0         irlba_2.3.5.1          
##  [46] RSQLite_2.3.9           httr_1.4.7              compiler_4.4.2         
##  [49] microbenchmark_1.5.0    rngtools_1.5.2          bit64_4.6.0-1          
##  [52] doParallel_1.0.17       brew_1.0-10             BiocParallel_1.40.0    
##  [55] DBI_1.2.3               R.utils_2.13.0          scatterplot3d_0.3-44   
##  [58] rjson_0.2.23            tools_4.4.2             ape_5.8-1              
##  [61] skmeans_0.2-18          flexclust_1.5.0         httpuv_1.6.15          
##  [64] R.oo_1.27.0             glue_1.8.0              promises_1.3.2         
##  [67] nlme_3.1-166            GOSemSim_2.32.0         gridtext_0.1.5         
##  [70] grid_4.4.2              cluster_2.1.6           reshape2_1.4.4         
##  [73] fgsea_1.32.2            generics_0.1.3          gtable_0.3.6           
##  [76] class_7.3-22            R.methodsS3_1.8.2       tidyr_1.3.1            
##  [79] data.table_1.17.0       xml2_1.3.6              XVector_0.46.0         
##  [82] ggrepel_0.9.6           foreach_1.5.2           pillar_1.10.1          
##  [85] markdown_1.13           stringr_1.5.1           yulab.utils_0.2.0      
##  [88] later_1.4.1             genefilter_1.88.0       circlize_0.4.16        
##  [91] splines_4.4.2           dplyr_1.1.4             treeio_1.30.0          
##  [94] lattice_0.22-6          survival_3.7-0          bit_4.5.0.1            
##  [97] annotate_1.84.0         tidyselect_1.2.1        GO.db_3.20.0           
## [100] ComplexHeatmap_2.25.2   tm_0.7-16               Biostrings_2.74.1      
## [103] NLP_0.3-2               bookdown_0.44           xfun_0.51              
## [106] matrixStats_1.5.0       stringi_1.8.4           UCSC.utils_1.2.0       
## [109] lazyeval_0.2.2          ggfun_0.1.8             yaml_2.3.10            
## [112] evaluate_1.0.3          codetools_0.2-20        tibble_3.2.1           
## [115] qvalue_2.38.0           Polychrome_1.5.1        ggplotify_0.1.2        
## [118] cli_3.6.4               xtable_1.8-4            munsell_0.5.1          
## [121] jquerylib_0.1.4         Rcpp_1.0.14             GenomeInfoDb_1.42.3    
## [124] png_0.1-8               XML_3.99-0.18           parallel_4.4.2         
## [127] simona_1.7.1            ggplot2_3.5.2           blob_1.2.4             
## [130] clusterProfiler_4.14.6  mclust_6.1.1            doRNG_1.8.6.1          
## [133] DOSE_4.0.1              slam_0.1-55             tidytree_0.4.6         
## [136] scales_1.3.0            purrr_1.0.4             crayon_1.5.3           
## [139] GetoptLong_1.0.5        rlang_1.1.5             cowplot_1.1.3          
## [142] fastmatch_1.1-6         KEGGREST_1.46.0
</code></pre>

  </div>

</section>


<style>
.footer p{
	color: #AAA;
	text-align: left;
	text-decoration: none;
	max-width:400px;
	border-top: 1px solid #AAA;
	padding-top:10px;
	font-size: 0.8em;
}
.footer p a {
	color: #AAA;
	text-align: left;
	text-decoration: none;
}
</style>

<footer class="footer">
<p>网站使用 <a href="https://gohugo.io/">Hugo</a>，<a href="https://bookdown.org/yihui/blogdown/">blogdown</a>，<a href="https://github.com/davidhampgonsalves/hugo-black-and-light-theme">Black & Light 主题</a>创建</p>
</footer>





<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>




<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


</body>
</html>



