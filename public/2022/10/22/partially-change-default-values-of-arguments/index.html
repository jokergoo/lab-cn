<!DOCTYPE html>
<html lang="en-US">
  <head><script src="/lab-cn/livereload.js?mindelay=10&amp;v=2&amp;port=4321&amp;path=lab-cn/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="A website built through Hugo and blogdown.">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


    
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400&display=swap" rel="stylesheet" media="print" type="text/css" onload="this.media='all'">
    

    


<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />




    <title>
      
      
         Partially change default values of arguments 
      
    </title>
    <link rel="canonical" href="http://localhost:4321/lab-cn/2022/10/22/partially-change-default-values-of-arguments/">

    <style>
  * {
    border:0;
    font:inherit;
    vertical-align:baseline;
    margin:0;
    padding:0;
    color: black;
    text-decoration-skip: ink;
    overflow-wrap: break-word;
  }

  body {
    font-family: Georgia,serif;
    line-height:160%;
    color:#1d1313;
    max-width:1000px;
    margin:auto;
    min-height: 600px;
    font-size: 17px;
  }

  p {
    margin: 20px 0;
  }

  a img {
    border:none;
  }

  img {
    margin: 10px auto 10px auto;
    max-width: 100%;
    display: block;
  }

  .left-justify { float: left; }
  .right-justify { float:right; }

  pre, code {
    font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
    background-color: #f7f7f7;
  }

  code {
    padding: 4px;
  }

  pre {
    margin-top: 0;
    margin-bottom: 16px;
    word-wrap: normal;
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
  }

  pre>code {
    padding: 0;
    margin: 0;
    font-size: 100%;
    word-break: normal;
    white-space: pre;
    background: transparent;
    border: 0;
  }

  pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: transparent;
    border: 0;
  }

  pre code::before,
  pre code::after {
    content: normal;
  }

  em,q,em,dfn {
    font-style:italic;
  }

  .sans,html .gist .gist-file .gist-meta {
    font-family:"Open Sans","Myriad Pro",Myriad,sans-serif;
  }

  .mono,pre,code,tt,p code,li code {
    font-family:Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;
  }

  strong {
    font-weight:600;
  }

  q:before {
    content:"\201C";
  }

  q:after {
    content:"\201D";
  }

  del,s {
    text-decoration:line-through;
  }

  blockquote {
    font-family:"Old Standard TT",serif;
    text-align:center;
    padding:50px;
  }

  blockquote p {
    display:inline-block;
    font-style:italic;
  }

  blockquote:before,blockquote:after {
    font-family:"Old Standard TT",serif;
    content:'\201C';
    color:#403c3b;
  }

  blockquote:after {
    content:'\201D';
  }

  hr {
    width:40%;
    height: 1px;
    background:#403c3b;
    margin: 25px auto;
  }


  h2, h3 {
    margin-top: 40px;
    margin-bottom: 20px;
  }

  h1 a,h2 a,h3 a {
    text-decoration:none;
  }

  h1,h2 {
    margin-top:28px;
  }

  h1 {
    font-size: 2em;
  }

  h2, h3 {
    font-size: 1.5em;
  }

  #sub-header, .date {
    color:#403c3b;
  }

  #sub-header {
    margin: 0 4px;
    font-style: italic;
  }

  #nav h1 a {
    color:#1d1313;
    line-height:120%;
  }

  .posts_listing a,#nav a {
    text-decoration: none;
  }

  li {
    margin-left: 20px;
  }

  ul li {
    margin-left: 20px;
    padding-top: 2px;
    padding-bottom: 2px;
  }


  #nav ul li:before, .posts_listing li:before {
    content:'';
    margin-right:0;
  }

  #content {
    text-align:left;
    width:100%;
    padding:30px 0 80px;
  }

  #content h1,#content h2 {
    margin-bottom:5px;
  }

  #content .entry-content {
    margin-top:15px;
  }

  #content .date {
    margin-left:3px;
  }


  .highlight {
    margin: 10px 0;
  }

  .posts_listing {
    margin:0 0 50px;
  }

  .posts_listing li {
    margin:0 0 25px 15px;
  }

 
  #nav {
    text-align:center;
    position:static;
    margin-top:60px;
  }

  a {
    text-decoration: underline;
    text-decoration-color: #CCC;
    text-underline-offset: 5px;
  }

  a:hover {
    text-decoration-color: black;
  }

  
  #nav li {
    list-style-type:none;
    display:table-cell;
    padding: 0 20px;
  }

  #links {
    display: flex;
    justify-content: space-between;
    margin: 50px 0 0 0;
  }

  #links :nth-child(1) {
    margin-right:0.5em;;
  }

  #links :nth-child(2) {
    margin-left:0.5em;;
  }

  #not-found {
    text-align: center;
  }

  #not-found a {
    font-size: 3em;
    text-decoration: none;
    display: inline-block;
    padding-top: 225px;
    padding-bottom: 225px;
  }


#soft-info table td {
  padding: 2px 10px 2px 0px;
}


  @media (max-width: 750px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    #nav h1 a {
      font-size:28px;
    }

    #nav li {
      font-size:13px;
      padding: 0 5px;
    }

    #content {
      margin-top:0;
      padding-top:50px;
      font-size:14px;
    }

    #content h1 {
      font-size:25px;
    }

    #content h2 {
      font-size:22px;
    }

    .posts_listing li div {
      font-size:12px;
    }
  }

  @media (max-width: 400px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    #nav h1 a {
      font-size:22px;
    }

    #nav li {
      font-size:12px;
      padding: 0 5px;
    }

    #content {
      margin-top:0;
      padding-top:20px;
      font-size:12px;
    }

    #content h1 {
      font-size:20px;
    }

    #content h2 {
      font-size:18px;
    }

    .posts_listing li div{
      font-size:12px;
    }
  }

  @media (prefers-color-scheme: dark) {
    *, #nav h1 a {
      color: #FDFDFD;
    }

    body {
      background: #121212;
    }

    pre, code {
      background-color: #262626;
    }

    #sub-header, .date {
      color: #BABABA;
    }

    hr {
      background: #EBEBEB;
    }
  }
</style>


    </head>
<style>
#nav-logo-text {
    float: left;
    margin-top: 0px;
    margin-left: 0px;
    font-size: 2em;
    font-weight: 100;
}
#at {
  font-size:24px;
  padding:0px 2px;
}
</style>
<script>
window.root_dir = "http:\/\/localhost:4321\/lab-cn\/";
const regex = /^https?:\/\/[^/]+?\//;
root_dir = root_dir.replace(regex, "/");
$( function() {
  $("#content img").each(function(i) {
        var old_src = $(this).attr("src");
        var pattern = new RegExp("^" + root_dir);
        if(!pattern.test(old_src)) {
            pattern = /^http(s):\/\//;
            if(!pattern.test(old_src)) {
                $(this).attr("src", root_dir + "/" + old_src);
            }
        }
    });
  $("#nav-logo-text").attr("href", root_dir);
  $("#no-found-a").attr("href", root_dir);

  var url = window.location.href;
  var pattern = /lab-cn/;
  var url2 = url.replace(pattern, "lab-en");
  $("#nav ul li:last-child a").attr("href", url2);
})
</script>
  <body>
    <section id=nav>
      <h1><a class="h-card" href="/"></a></h1>
      <a href="#" id="nav-logo-text">Gu<span style="padding:0px 2px">.</span>Z<span id="at">@</span>SUAT-SZ</a>
      <ul style="float:right">
        
          <li><a href="/lab-cn/research/">研究</a></li>
        
          <li><a href="/lab-cn/publication/">论文</a></li>
        
          <li><a href="/lab-cn/software/">软件</a></li>
        
          <li><a href="/lab-cn/post">文章</a></li>
        
          <li><a href="/lab-cn/members/">成员</a></li>
        
          <li><a href="/lab-cn/opening/">职位</a></li>
        
          <li><a href="/lab-en/">EN</a></li>
        
      </ul>
      <div style="clear:both"></div>
    </section>


<section id=content>
  <h1 style="margin-bottom: 40px"> Partially change default values of arguments </h1>

  
    <div id=sub-header>
      Zuguang Gu · October 2022
    </div>
  

  <div class="entry-content">
    <p>This is the problem I have. For example, in the <code>Heatmap()</code> function in the <strong>ComplexHeatmap</strong> package, one of its argument <code>row_title_gp</code> has a default value <code>gpar(fontsize = 13.2)</code>:</p>
<pre><code class="language-r">Heatmap = function(..., row_title_gp = gpar(fontsize = 13.2), ...) {
    ...
}
</code></pre>
<p>Here <code>row_title_gp</code> controls the graphics parameters for the row title and it accepts a list of other parameters, such as <code>col</code> and <code>fontfamily</code>.
Now the problem is when users set <code>row_title_gp</code> with other parameters, e.g. to set the color of text, they must also set <code>fontsize</code> with its default value,
even though when they only want to set the color. If they do not set <code>fontsize</code>, it will not use the default value of 13.2, while it will use the &ldquo;global default&rdquo; which is 12 (try <code>get.gpar(&quot;fontsize&quot;)</code>).</p>
<pre><code class="language-r">Heatmap(..., row_title_gp = gpar(fontsize = 13.2,  col = &quot;red&quot;))
</code></pre>
<p>This is tedious and user-unfriendly.</p>
<p>The good thing is, in the function arguments, explictely coding as <code>row_title_gp = gpar(fontsize = 13.2)</code> helps users to know that a specific default is set
to the argument <code>row_title_gp</code> which is not the system-default one. But the bad thing is, users might forget to set <code>fontsize</code> at the same time if they set other parameters.</p>
<p>Now the question is: can the default paramters which are not modified by users be automatically saved? In the prevous example, when we set <code>Heatmap(..., row_title_gp = gpar(col = &quot;red&quot;))</code>,
can <code>row_title_gp</code> still use <code>fontsize = 13.2</code>?</p>
<p>One widely-used solution is to write a &ldquo;control&rdquo; function which controls the default parameters. For example, in the <code>Mclust()</code> function from the <strong>mclust</strong> package:</p>
<pre><code class="language-r">Mclust = function (..., control = emControl(), ...) {
    ...
}
</code></pre>
<p>There is a <code>emControl()</code> function which takes care of the default values.</p>
<pre><code class="language-r">library(mclust)
emControl()
</code></pre>
<pre><code>## $eps
## [1] 2.220446e-16
## 
## $tol
## [1] 1.000000e-05 1.490116e-08
## 
## $itmax
## [1] 2147483647 2147483647
## 
## $equalPro
## [1] FALSE
</code></pre>
<p>And if only change one parameter, default values for other parameters are still used:</p>
<pre><code class="language-r">emControl(eps = 1e-10)
</code></pre>
<pre><code>## $eps
## [1] 1e-10
## 
## $tol
## [1] 1.000000e-05 1.490116e-08
## 
## $itmax
## [1] 2147483647 2147483647
## 
## $equalPro
## [1] FALSE
</code></pre>
<p>Similarly, in <strong>ComplexHeatmap</strong>, to control the graphics parameters for axes, there is also a &ldquo;control-like&rdquo; function <code>default_axis_param()</code> which takes care of
the default graphics parameters for axes.</p>
<p>Writing a &ldquo;control&rdquo; or &ldquo;default_param&rdquo; function is very helpful when the default parameter list is long. The drawback is also obvous. Users neeed to execute the &ldquo;control&rdquo;
functions or go to the documentations to see the exact default values.</p>
<p>Now my question is, if the default parameters are still hard coded in the argument of the function, can we still keep the default parameters if they are not specified by users?</p>
<p>The solution is not difficult. If default parameters are coded in the argument, just extract them. Let&rsquo;s take the argument <code>row_title_gp</code> in <code>Heatmap()</code> as an example.</p>
<p><strong>Step 1:</strong> Get the new value of <code>row_title_gp</code> which is specified by users.</p>
<pre><code class="language-r">Heatmap = function(..., row_title_gp = gpar(fontsize = 13.2), ...) {
    new = row_title_gp
    ...
}
</code></pre>
<p><strong>Step 2:</strong> Get the default value of <code>row_title_gp</code> which is coded in the function definition.</p>
<p>This is a little bit tricky. If users have specified <code>row_title_gp</code>, its the default value is overwritten and not seeable in <code>Heatmap()</code>. Nevertheless,
we can use <code>sys.function()</code> to get the function that was called by users (which is <code>Heatmap()</code>), next with the <code>formals</code> functions
to obtain the argument lists, and finally evaluate the argument (with <code>eval()</code>) to obtain the default value of <code>row_title_gp</code>.</p>
<pre><code class="language-r">Heatmap = function(..., row_title_gp = gpar(fontsize = 13.2), ...) {
    new = row_title_gp
    fml = formals(sys.function(sys.parent(1)))
    default = eval(fml[[&quot;row_title_gp&quot;]])
    ...
}
</code></pre>
<p><strong>Step 3:</strong> Merge the new value and default value.</p>
<p>The new code is very straightforward.</p>
<pre><code class="language-r">Heatmap = function(..., row_title_gp = gpar(fontsize = 13.2), ...) {
    new = row_title_gp
    fml = formals(sys.function(sys.parent(1)))
    default = eval(fml[[&quot;row_title_gp&quot;]])

    dnm = setdiff(names(default), names(new))
    if(length(dnm) &gt; 0) {
        for(n in dnm) lt[[n]] = default[[n]]
    }
    row_title_gp = new
    ...
}
</code></pre>
<p>Next we want to make this functionality more general. The following utility function <code>mark_default()</code> can be used
inside any function which &ldquo;marks&rdquo; arguments to automatically reuse the default parameters.</p>
<pre><code class="language-r">mark_default = function(arg) {
    e = parent.frame()
    new = get(arg, envir = e)
    fml = formals(sys.function(sys.parent(1)))
    default = eval(fml[[arg]])

    lt = new
    dnm = setdiff(names(default), names(new))
    if(length(dnm) &gt; 0) {
        for(n in dnm) lt[[n]] = default[[n]]
    }

    assign(arg, lt, envir = e)
    invisible(lt)
}
</code></pre>
<p>Let me show you some simple experiments of <code>mark_default()</code>.</p>
<p>In the first experiment, there are two default parameters for <code>gp</code> which are <code>col</code> and <code>lty</code>.
As you can see, if only <code>col</code> is set, <code>lty</code> is lost.</p>
<pre><code class="language-r">library(grid)
draw_sth = function(gp = gpar(col = &quot;red&quot;, lty = 2)) {
    print(gp)
}
draw_sth(gp = gpar(col = &quot;black&quot;))
</code></pre>
<pre><code>## $col
## [1] &quot;black&quot;
</code></pre>
<p>Next, we simply add <code>mark_default()</code> inside <code>draw_sth()</code> and mark the argument <code>gp</code>. Now the default <code>gpar(col = &quot;red&quot;, lty = 2)</code>
can be reused.</p>
<pre><code class="language-r">draw_sth = function(gp = gpar(col = &quot;red&quot;, lty = 2)) {
    mark_default(&quot;gp&quot;)
    print(gp)
}
draw_sth(gp = gpar(col = &quot;black&quot;))
</code></pre>
<pre><code>## $col
## [1] &quot;black&quot;
## 
## $lty
## [1] 2
</code></pre>
<pre><code class="language-r">draw_sth(gp = gpar(lwd = 3))
</code></pre>
<pre><code>## $lwd
## [1] 3
## 
## $col
## [1] &quot;red&quot;
## 
## $lty
## [1] 2
</code></pre>
<!-- 
f = function(x, y = gpar(a = 1, b = 2)) {
    mark_default("y")
    
    print(y)
    y
}

mark_default = function(arg, merge_fun = merge_fun_list) {
    e = parent.frame()
    value = get(arg, envir = e)
    fml = formals(sys.function(sys.parent(1)))
    oe = try(dft <- eval(fml[[arg]]), silent = TRUE)
    if(inherits(oe, "try-error")) {
        if(grepl("argument is missing, with no default", oe)) {
            stop("Argument '", arg, "' has no default.")
        } else {
            stop(oe)
        }
    }

    lt = merge_fun(dft, value)
    assign(arg, lt, envir = e)
    invisible(lt)
}

merge_fun_list = function(default, new) {
    lt = new
    dnm = setdiff(names(default), names(new))
    if(length(dnm) > 0) {
        for(n in dnm) lt[[n]] = default[[n]]
    }
    lt
}
 -->

  </div>

</section>


<style>
.footer p{
	color: #AAA;
	text-align: left;
	text-decoration: none;
	max-width:400px;
	border-top: 1px solid #AAA;
	padding-top:10px;
	font-size: 0.8em;
}
.footer p a {
	color: #AAA;
	text-align: left;
	text-decoration: none;
}
</style>

<footer class="footer">
<p>网站使用 <a href="https://gohugo.io/">Hugo</a>，<a href="https://bookdown.org/yihui/blogdown/">blogdown</a>，<a href="https://github.com/davidhampgonsalves/hugo-black-and-light-theme">Black & Light 主题</a>创建</p>
</footer>





<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>




<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


</body>
</html>



