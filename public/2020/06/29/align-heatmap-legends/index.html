<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="A website built through Hugo and blogdown.">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


    
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400&display=swap" rel="stylesheet" media="print" type="text/css" onload="this.media='all'">
    

    


<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />




    <title>
      
      
         Align heatmap legends 
      
    </title>
    <link rel="canonical" href="/lab-cn/2020/06/29/align-heatmap-legends/">

    <style>
  * {
    border:0;
    font:inherit;
    vertical-align:baseline;
    margin:0;
    padding:0;
    color: black;
    text-decoration-skip: ink;
    overflow-wrap: break-word;
  }

  body {
    font-family: Georgia,serif;
    line-height:160%;
    color:#1d1313;
    max-width:1000px;
    margin:auto;
    min-height: 600px;
    font-size: 17px;
  }

  p {
    margin: 20px 0;
  }

  a img {
    border:none;
  }

  img {
    margin: 10px auto 10px auto;
    max-width: 100%;
    display: block;
  }

  .left-justify { float: left; }
  .right-justify { float:right; }

  pre, code {
    font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
    background-color: #f7f7f7;
  }

  code {
    padding: 4px;
  }

  pre {
    margin-top: 0;
    margin-bottom: 16px;
    word-wrap: normal;
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
  }

  pre>code {
    padding: 0;
    margin: 0;
    font-size: 100%;
    word-break: normal;
    white-space: pre;
    background: transparent;
    border: 0;
  }

  pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: transparent;
    border: 0;
  }

  pre code::before,
  pre code::after {
    content: normal;
  }

  em,q,em,dfn {
    font-style:italic;
  }

  .sans,html .gist .gist-file .gist-meta {
    font-family:"Open Sans","Myriad Pro",Myriad,sans-serif;
  }

  .mono,pre,code,tt,p code,li code {
    font-family:Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;
  }

  strong {
    font-weight:600;
  }

  q:before {
    content:"\201C";
  }

  q:after {
    content:"\201D";
  }

  del,s {
    text-decoration:line-through;
  }

  blockquote {
    font-family:"Old Standard TT",serif;
    text-align:center;
    padding:50px;
  }

  blockquote p {
    display:inline-block;
    font-style:italic;
  }

  blockquote:before,blockquote:after {
    font-family:"Old Standard TT",serif;
    content:'\201C';
    color:#403c3b;
  }

  blockquote:after {
    content:'\201D';
  }

  hr {
    width:40%;
    height: 1px;
    background:#403c3b;
    margin: 25px auto;
  }


  h2, h3 {
    margin-top: 40px;
    margin-bottom: 20px;
  }

  h1 a,h2 a,h3 a {
    text-decoration:none;
  }

  h1,h2 {
    margin-top:28px;
  }

  h1 {
    font-size: 2em;
  }

  h2, h3 {
    font-size: 1.5em;
  }

  #sub-header, .date {
    color:#403c3b;
  }

  #sub-header {
    margin: 0 4px;
    font-style: italic;
  }

  #nav h1 a {
    color:#1d1313;
    line-height:120%;
  }

  .posts_listing a,#nav a {
    text-decoration: none;
  }

  li {
    margin-left: 20px;
  }

  ul li {
    margin-left: 20px;
    padding-top: 2px;
    padding-bottom: 2px;
  }


  #nav ul li:before, .posts_listing li:before {
    content:'';
    margin-right:0;
  }

  #content {
    text-align:left;
    width:100%;
    padding:30px 0 80px;
  }

  #content h1,#content h2 {
    margin-bottom:5px;
  }

  #content .entry-content {
    margin-top:15px;
  }

  #content .date {
    margin-left:3px;
  }


  .highlight {
    margin: 10px 0;
  }

  .posts_listing {
    margin:0 0 50px;
  }

  .posts_listing li {
    margin:0 0 25px 15px;
  }

 
  #nav {
    text-align:center;
    position:static;
    margin-top:60px;
  }

  a {
    text-decoration: underline;
    text-decoration-color: #CCC;
    text-underline-offset: 5px;
  }

  a:hover {
    text-decoration-color: black;
  }

  
  #nav li {
    list-style-type:none;
    display:table-cell;
    padding: 0 20px;
  }

  #links {
    display: flex;
    justify-content: space-between;
    margin: 50px 0 0 0;
  }

  #links :nth-child(1) {
    margin-right:0.5em;;
  }

  #links :nth-child(2) {
    margin-left:0.5em;;
  }

  #not-found {
    text-align: center;
  }

  #not-found a {
    font-size: 3em;
    text-decoration: none;
    display: inline-block;
    padding-top: 225px;
    padding-bottom: 225px;
  }


#soft-info table td {
  padding: 2px 10px 2px 0px;
}


  @media (max-width: 750px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    #nav h1 a {
      font-size:28px;
    }

    #nav li {
      font-size:13px;
      padding: 0 5px;
    }

    #content {
      margin-top:0;
      padding-top:50px;
      font-size:14px;
    }

    #content h1 {
      font-size:25px;
    }

    #content h2 {
      font-size:22px;
    }

    .posts_listing li div {
      font-size:12px;
    }
  }

  @media (max-width: 400px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    #nav h1 a {
      font-size:22px;
    }

    #nav li {
      font-size:12px;
      padding: 0 5px;
    }

    #content {
      margin-top:0;
      padding-top:20px;
      font-size:12px;
    }

    #content h1 {
      font-size:20px;
    }

    #content h2 {
      font-size:18px;
    }

    .posts_listing li div{
      font-size:12px;
    }
  }

  @media (prefers-color-scheme: dark) {
    *, #nav h1 a {
      color: #FDFDFD;
    }

    body {
      background: #121212;
    }

    pre, code {
      background-color: #262626;
    }

    #sub-header, .date {
      color: #BABABA;
    }

    hr {
      background: #EBEBEB;
    }
  }
</style>


    </head>
<style>
#nav-logo-text {
    float: left;
    margin-top: 0px;
    margin-left: 0px;
    font-size: 2em;
    font-weight: 100;
}
#at {
  font-size:24px;
  padding:0px 2px;
}
</style>
<script>
window.root_dir = "\/lab-cn\/";
const regex = /^https?:\/\/[^/]+?\//;
root_dir = root_dir.replace(regex, "/");
$( function() {
  $("#content img").each(function(i) {
        var old_src = $(this).attr("src");
        var pattern = new RegExp("^" + root_dir);
        if(!pattern.test(old_src)) {
            pattern = /^http(s):\/\//;
            if(!pattern.test(old_src)) {
                $(this).attr("src", root_dir + "/" + old_src);
            }
        }
    });
  $("#nav-logo-text").attr("href", root_dir);
  $("#no-found-a").attr("href", root_dir);

  var url = window.location.href;
  var pattern = /lab-cn/;
  var url2 = url.replace(pattern, "lab-en");
  $("#nav ul li:last-child a").attr("href", url2);
})
</script>
  <body>
    <section id=nav>
      <h1><a class="h-card" href="/"></a></h1>
      <a href="#" id="nav-logo-text">Gu<span style="padding:0px 2px">.</span>Z<span id="at">@</span>SUAT-SZ</a>
      <ul style="float:right">
        
          <li><a href="/lab-cn/research/">研究</a></li>
        
          <li><a href="/lab-cn/publication/">论文</a></li>
        
          <li><a href="/lab-cn/software/">软件</a></li>
        
          <li><a href="/lab-cn/post">文章</a></li>
        
          <li><a href="/lab-cn/members/">成员</a></li>
        
          <li><a href="/lab-cn/opening/">职位</a></li>
        
          <li><a href="/lab-en/">EN</a></li>
        
      </ul>
      <div style="clear:both"></div>
    </section>


<section id=content>
  <h1 style="margin-bottom: 40px"> Align heatmap legends </h1>

  
    <div id=sub-header>
      Zuguang Gu · June 2020
    </div>
  

  <div class="entry-content">
    <p>In this post, I will demonstrate the automatic alignment of heatmap legends.
This new feature in avaiable in <strong>ComplexHeatmap</strong> &gt;= 2.5.4.</p>
<p>In the following heatmaps, I use a random 10x10 matrix generated as
follows:</p>
<pre><code class="language-r">library(ComplexHeatmap)
set.seed(123)
m = matrix(rnorm(100), 10)
</code></pre>
<p>In the older versions (&lt;= 2.5.3), the legends are put in the middle of a
viewport which almost has the same height as the whole plot. It looks nice
when there are no column names in the heatmap.</p>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;" />
<p>When using heatmaps to visualize large data sets (e.g. with many columns),
normally we turn off the column names and the legends are in good positions.
However, for some cases, e.g. for a small matrix where column names/labels are
important to visualize, putting the legends in the center of that viewport
will make the plot look very strange. In the next code, I add long column
names to the matrix.</p>
<pre><code class="language-r">colnames(m) = strrep(letters[1:10], 20)
</code></pre>
<p>And the legend is too far away from the heatmap and it looks really bad.</p>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;" />
<p>From version 2.5.4, the alignment of the legends can be controlled by
<code>align_heatmap_legend</code> and <code>align_annotation_legend</code> arguments in
the <code>draw()</code> function. There are three possible values:</p>
<ul>
<li><code>global_center</code>: This is the same as in the old versions. The legends
are put in the middle of the viewport.</li>
<li><code>heatmap_center</code>: The center of the legends is aligned to the center
of the heatmap body.</li>
<li><code>heatmap_top</code>: The top of the legends is aligned to the top of the heatmap body.</li>
</ul>
<p>An example code of setting e.g. <code>align_heatmap_legend</code> is:</p>
<pre><code class="language-r">ht = Heatmap(m, ...)
draw(ht, align_heatmap_legend = &quot;heatmap_center&quot;, ...)
</code></pre>
<p>The visual effects of the three options are demonstrated in the following plot:</p>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;" />
<p>Although you can manually set <code>align_heatmap_legend</code>/<code>align_annotation_legend</code>,
the good thing in version 2.5.4 is it can automatically identify which value
to set to these two arguments. The basic rules are (take <code>align_heatmap_legend</code>
as an example):</p>
<ol>
<li>If the height of the legends is smaller than the height of the heatmap body,
the value for <code>align_heatmap_legend</code> is set to <code>&quot;heatmap_center&quot;</code>.</li>
<li>If the height of the legends is smaller than the height of the heatmap body plus
the sum of heights of the bottom elements of the heatmap (e.g., column names, bottom annotations),
the value for <code>align_heatmap_legend</code> is set to <code>&quot;heatmap_top&quot;</code>.</li>
<li>For other scenarios, the value for <code>align_heatmap_legend</code> is set to <code>&quot;global_center&quot;</code>.</li>
</ol>
<p>In the following code, there are two heatmaps with two legends. The height of the
two legends is still smaller than the height of the heatmap body, thus, as we can observe
from the plot, the legends are centered to the center of the heatmap body.</p>
<pre><code class="language-r">Heatmap(m, name = &quot;mat1&quot;) + 
	Heatmap(m, name = &quot;mat2&quot;)
</code></pre>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-8-1.png" width="384" style="display: block; margin: auto;" />
<p>Next we add a third heatmap. Now the legends are higher than the
heatmap body. Thus they are aligned to the top of the heatmap body.</p>
<pre><code class="language-r">Heatmap(m, name = &quot;mat1&quot;) + 
	Heatmap(m, name = &quot;mat2&quot;) + 
	Heatmap(m, name = &quot;mat3&quot;)
</code></pre>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-9-1.png" width="576" style="display: block; margin: auto;" />
<p>When there are four legends, their height is larger than the height of the heatmap body
and plus column names, so the mode is set to <code>&quot;global_center&quot;</code>.</p>
<pre><code class="language-r">Heatmap(m, name = &quot;mat1&quot;) + 
	Heatmap(m, name = &quot;mat2&quot;) + 
	Heatmap(m, name = &quot;mat3&quot;) + 
	Heatmap(m, name = &quot;mat4&quot;)
</code></pre>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" />
<p>When there are five legends, since the height of the legends now exceeds the height of the plot,
now they are wrapped into two columns.</p>
<pre><code class="language-r">Heatmap(m, name = &quot;mat1&quot;) + 
	Heatmap(m, name = &quot;mat2&quot;) + 
	Heatmap(m, name = &quot;mat3&quot;) + 
	Heatmap(m, name = &quot;mat4&quot;) + 
	Heatmap(m, name = &quot;mat5&quot;)
</code></pre>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" />
<p>Similarly, for ten legends, they are wrapped into three columns, so all the legends are drawn
and visible in the plot.</p>
<pre><code class="language-r">Heatmap(m, name = &quot;mat1&quot;) + Heatmap(m, name = &quot;mat2&quot;) + 
	Heatmap(m, name = &quot;mat3&quot;) + Heatmap(m, name = &quot;mat4&quot;) + 
	Heatmap(m, name = &quot;mat5&quot;) + Heatmap(m, name = &quot;mat6&quot;) + 
	Heatmap(m, name = &quot;mat7&quot;) + Heatmap(m, name = &quot;mat8&quot;) + 
	Heatmap(m, name = &quot;mat9&quot;) + Heatmap(m, name = &quot;mat10&quot;)
</code></pre>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" />
<p>Let&rsquo;s try also with the annotation legends.</p>
<pre><code class="language-r">ha = HeatmapAnnotation(foo1 = 1:10)
Heatmap(m, name = &quot;mat&quot;, top_annotation = ha)
</code></pre>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-13-1.png" width="288" style="display: block; margin: auto;" />
<pre><code class="language-r">ha = HeatmapAnnotation(foo1 = 1:10, foo2 = 1:10)
Heatmap(m, name = &quot;mat&quot;, top_annotation = ha)
</code></pre>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-14-1.png" width="288" style="display: block; margin: auto;" />
<p>Currently, there is a limit for this new functionality that the legends might
overlap to the annotaiton labels if they are on the same side of the heatmap.</p>
<pre><code class="language-r">ha = HeatmapAnnotation(foo1 = 1:10, foo2 = 1:10, foo3 = 1:10)
Heatmap(m, name = &quot;mat&quot;, top_annotation = ha)
</code></pre>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-15-1.png" width="288" style="display: block; margin: auto;" />
<p>One solution is to move the annotation labels to the other side.</p>
<pre><code class="language-r">ha = HeatmapAnnotation(foo1 = 1:10, foo2 = 1:10, foo3 = 1:10, 
	annotation_name_side = &quot;left&quot;)
Heatmap(m, name = &quot;mat&quot;, top_annotation = ha)
</code></pre>
<img src="/lab-cn/post/2020-06-29-align-heatmap-legends_files/figure-html/unnamed-chunk-16-1.png" width="288" style="display: block; margin: auto;" />
<p>This new functionality also works for the horizontal legend list that is
put at the bottom of the heatmaps.</p>

  </div>

</section>


<style>
.footer p{
	color: #AAA;
	text-align: left;
	text-decoration: none;
	max-width:400px;
	border-top: 1px solid #AAA;
	padding-top:10px;
	font-size: 0.8em;
}
.footer p a {
	color: #AAA;
	text-align: left;
	text-decoration: none;
}
</style>

<footer class="footer">
<p>网站使用 <a href="https://gohugo.io/">Hugo</a>，<a href="https://bookdown.org/yihui/blogdown/">blogdown</a>，<a href="https://github.com/davidhampgonsalves/hugo-black-and-light-theme">Black & Light 主题</a>创建</p>
</footer>





<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>





</body>
</html>



